# Жизненный цикл компонента

----

**Жизненный цикл компонента** - это последовательность этапов, через которые проходит компонент от момента его создания до момента его удаления из DOM.

- Mount (монтирование)
- Update (обновление)
- Unmount (демонтирование)

1. **Mounting** - фаза, во время которой компонент впервые добавляется в DOM. 

Начинается процесс [рендеринга](./render.md)

- Происходит расчет локальных значений, объявленных в компоненте (переменные)
- Хуки инициализируются в порядке объявления в компоненте. 
- Будет вычислен результат, который возвращает хук useMemo()
- useCallback() сохранит ссылку на объявленную в нем функцию. Это нужно, чтобы не пересоздавать ссылку на эту же функцию при каждом апдейте компонента. Это помогает избежать лишних ререндеров компонентов, зависящих от этой функции.
- React рекурсивно рендерит дочерние компоненты исходного (проделывает с ними те же действия).
- React отрендерил компонент, получил его представление и переходит в **commit**-фазу. Полученные DOM-ноды вставляются в реальное DOM-дерево.
- React сетит ref’ы. Все рефы получают свое значение (перестают быть null или undefined).
- Запустятся useLayoutEffect. После коммита, но перед пеинтом запустятся Layout эффекты.
- Происходит отрисовка DOM браузером.
- Запуск побочных эффектов, объявленных в useEffect().

2. **update компонента**

**Компонент может обновиться по 2-ум причинам:**

- Обновились пропсы
- Обновился его стейт

Ререндеринг компонента неизбежно ведет к рекурсивному ререндерингу его дочерних компонентов, даже если их пропсы не были изменены (если они не мемоизированы при помощи React.memo()).

- Происходит повторное вычисление новых пропсов, локальных переменных и стейтов.
- React сравнивает зависимости хуков на наличие изменения. Хуки без зависимостей или с измененными зависимостями будут вызваны повторно. Хуки без измененных зависимостей будут пропущены.
- React render компонента. Commit, обновляет только те элементы, которые были изменены. 
- Перед обновлением DOM ref’ы снова получат значение null.
- cleanup функции useLayoutEffect(), которые были возвращены в ходе предыдущего рендера отработают со стейтами или пропсами имеющими значения предыдущих рендеров.
- React снова засетит ref’ы.
- Снова вызываются Layout эффекты (соответственно состоянию их зависимостей).
- Перерисовка DOM
- Вызываются cleanup функции возвращенные useEffect’ом во время предыдущего рендера. Они так же будут иметь “устаревшие” пропсы или состояния.
- Произойдет очередной вызов побочных эффектов, если зависимости в useEffect() были изменены.

3. **Unmount компонента**

Этап размонтирования и удаления компонента из DOM.

- Происходит финальный запуск cleanup-функций Layout эффектов
- Ансетятся ref’ы, так как удаляются DOM-элементы, на которые они ссылаются.
- Удаляются DOM-узлы.

- [React](./react.md) 